<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Vallarta Gardens ¬∑ La Cruz de Huanacaxtle</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Jost:wght@200;300;400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
  :root {
    --cream: #FAF7F2; --warm: #F0E8D8;
    --ocean: #1C4E6E; --ocean-deep: #0D2E44;
    --turquoise: #4AACCF; --gold: #C8A96E; --gold-light: #E8C98E;
  }
  html, body { width:100%; height:100%; font-family:'Jost',sans-serif; background:var(--ocean-deep); overflow:hidden; }
  #welcome { position:fixed; inset:0; z-index:100; display:flex; flex-direction:column; transition:opacity 0.8s ease, transform 0.8s ease; }
  #welcome.hiding { opacity:0; transform:scale(1.04); pointer-events:none; }
  .hero-bg { position:absolute; inset:0; filter:brightness(0.52); animation:slowZoom 18s ease-out forwards; background-size:cover; background-position:center 30%; }
  @keyframes slowZoom { to { transform:scale(1.06); } }
  .hero-overlay { position:absolute; inset:0; background: linear-gradient(to top, rgba(13,46,68,0.97) 0%, rgba(13,46,68,0.3) 55%, transparent 100%), linear-gradient(to right, rgba(13,46,68,0.45) 0%, transparent 65%); }
  .hero-content { position:relative; z-index:2; display:flex; flex-direction:column; justify-content:flex-end; height:100%; padding:clamp(32px,6vw,72px); padding-bottom:clamp(48px,8vw,88px); }
  .property-tag { display:inline-flex; align-items:center; gap:8px; background:rgba(200,169,110,0.15); border:1px solid rgba(200,169,110,0.4); border-radius:40px; padding:7px 18px; font-size:11px; font-weight:400; letter-spacing:3px; text-transform:uppercase; color:var(--gold-light); margin-bottom:24px; width:fit-content; opacity:0; animation:fadeUp 0.7s 0.5s forwards; }
  .property-tag::before { content:''; width:6px; height:6px; border-radius:50%; background:var(--gold); animation:blink 2s infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }
  h1 { font-family:'Cormorant Garamond',serif; font-size:clamp(52px,10vw,112px); font-weight:300; line-height:0.92; color:white; letter-spacing:-1px; margin-bottom:10px; opacity:0; animation:fadeUp 0.8s 0.7s forwards; }
  h1 em { font-style:italic; color:rgba(255,255,255,0.7); }
  .location-line { display:flex; align-items:center; gap:12px; margin-bottom:44px; opacity:0; animation:fadeUp 0.7s 0.9s forwards; }
  .location-line::before { content:''; width:32px; height:1px; background:var(--gold); flex-shrink:0; }
  .location-line span { font-size:13px; font-weight:200; letter-spacing:4px; text-transform:uppercase; color:rgba(255,255,255,0.5); }
  .cta-group { display:flex; flex-direction:column; gap:14px; max-width:420px; opacity:0; animation:fadeUp 0.7s 1.1s forwards; }
  .btn-primary { display:flex; align-items:center; justify-content:space-between; background:var(--gold); color:var(--ocean-deep); border:none; border-radius:12px; padding:20px 28px; font-family:'Jost',sans-serif; font-size:16px; font-weight:500; cursor:pointer; transition:all 0.3s; width:100%; }
  .btn-primary:hover { background:var(--gold-light); transform:translateY(-2px); box-shadow:0 12px 40px rgba(200,169,110,0.35); }
  .btn-primary .btn-sub { font-size:12px; font-weight:300; opacity:0.7; margin-top:2px; }
  .btn-primary .arr { font-size:22px; }
  .hero-strip { position:absolute; top:clamp(24px,4vw,48px); right:clamp(24px,4vw,48px); display:flex; flex-direction:column; align-items:flex-end; gap:6px; opacity:0; animation:fadeIn 0.8s 1.3s forwards; }
  .strip-badge { background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.15); border-radius:8px; padding:8px 14px; font-size:12px; font-weight:300; color:rgba(255,255,255,0.7); letter-spacing:1px; backdrop-filter:blur(8px); }
  #tour-screen { position:fixed; inset:0; z-index:50; opacity:0; pointer-events:none; transition:opacity 0.8s ease; display:flex; flex-direction:column; background:url('https://i.imgur.com/fh2quot.jpeg') center/cover; }
  #tour-screen.active { opacity:1; pointer-events:all; }
  .tour-bar { display:flex; align-items:center; justify-content:space-between; padding:14px 24px; background:var(--ocean-deep); border-bottom:1px solid rgba(255,255,255,0.08); flex-shrink:0; }
  .tour-brand { font-family:'Cormorant Garamond',serif; font-size:22px; font-weight:300; color:white; letter-spacing:1px; }
  .tour-brand em { font-style:italic; color:var(--gold); }
  .tour-actions { display:flex; align-items:center; gap:10px; }
  .tour-btn { display:flex; align-items:center; gap:7px; background:rgba(255,255,255,0.07); border:1px solid rgba(255,255,255,0.12); border-radius:8px; padding:9px 16px; color:white; font-family:'Jost',sans-serif; font-size:13px; font-weight:300; cursor:pointer; transition:all 0.25s; text-decoration:none; }
  .tour-btn:hover { background:rgba(255,255,255,0.13); }
  .tour-btn.gold { background:rgba(200,169,110,0.15); border-color:rgba(200,169,110,0.35); color:var(--gold-light); }
  .tour-btn.gold:hover { background:rgba(200,169,110,0.25); }
  .back-btn { background:none; border:none; color:rgba(255,255,255,0.5); font-size:13px; font-family:'Jost',sans-serif; cursor:pointer; display:flex; align-items:center; gap:6px; padding:9px 12px; border-radius:8px; transition:all 0.2s; }
  .back-btn:hover { color:white; background:rgba(255,255,255,0.07); }
  .chapter-bar { display:flex; align-items:center; gap:8px; padding:12px 24px; background:rgba(10,38,56,0.98); border-bottom:1px solid rgba(255,255,255,0.06); overflow-x:auto; flex-shrink:0; scrollbar-width:none; }
  .chapter-bar::-webkit-scrollbar { display:none; }
  .chapter-pill { display:flex; align-items:center; gap:7px; white-space:nowrap; padding:8px 18px; border-radius:24px; font-size:12px; font-weight:400; letter-spacing:0.5px; color:rgba(255,255,255,0.45); background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.08); cursor:pointer; transition:all 0.3s ease; user-select:none; }
  .chapter-pill:hover { color:rgba(255,255,255,0.75); background:rgba(255,255,255,0.1); border-color:rgba(255,255,255,0.2); }
  .chapter-pill.active { background:rgba(200,169,110,0.2); border-color:rgba(200,169,110,0.5); color:var(--gold-light); }
  .chapter-dot { width:6px; height:6px; border-radius:50%; background:currentColor; opacity:0.7; }
  .tour-main { flex:1; position:relative; overflow:hidden; }
  #chapterOverlay { position:absolute; inset:0; background:rgba(10,30,46,0.92); backdrop-filter:blur(6px); z-index:10; display:none; flex-direction:column; overflow-y:auto; }
  #chapterOverlay.open { display:flex; animation:fadeIn 0.35s ease; }
  .chapter-card { max-width:680px; width:100%; margin:auto; padding:40px 32px; }
  .chapter-card-label { font-size:11px; letter-spacing:4px; text-transform:uppercase; color:var(--gold); margin-bottom:12px; font-weight:400; }
  .chapter-card h2 { font-family:'Cormorant Garamond',serif; font-size:clamp(32px,5vw,52px); font-weight:300; color:white; line-height:1.1; margin-bottom:16px; }
  .chapter-card .chapter-desc { font-size:15px; color:rgba(255,255,255,0.6); line-height:1.7; margin-bottom:32px; font-weight:300; }
  .info-row { display:flex; gap:14px; align-items:flex-start; background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.09); border-radius:12px; padding:16px 20px; margin-bottom:10px; }
  .info-row-icon { font-size:22px; flex-shrink:0; margin-top:2px; }
  .info-row h4 { font-size:14px; font-weight:500; color:white; margin-bottom:3px; }
  .info-row p { font-size:13px; color:rgba(255,255,255,0.55); line-height:1.6; }
  .copy-inline { display:inline-flex; align-items:center; gap:5px; margin-top:8px; background:var(--ocean); color:white; border:none; border-radius:6px; padding:6px 12px; font-size:11px; font-family:'Jost',sans-serif; cursor:pointer; transition:all 0.2s; }
  .copy-inline:hover { background:var(--ocean-deep); }
  .spot-row { display:flex; gap:14px; align-items:flex-start; padding:14px 0; border-bottom:1px solid rgba(255,255,255,0.07); }
  .spot-row:last-child { border-bottom:none; }
  .spot-num-w { width:28px; height:28px; border-radius:50%; background:var(--gold); color:var(--ocean-deep); font-family:'Cormorant Garamond',serif; font-size:16px; font-weight:700; display:flex; align-items:center; justify-content:center; flex-shrink:0; margin-top:2px; }
  .spot-row h5 { font-size:14px; font-weight:500; color:white; margin-bottom:3px; }
  .spot-row p { font-size:13px; color:rgba(255,255,255,0.5); line-height:1.5; }
  #info-panel { position:fixed; top:0; right:0; bottom:0; width:min(380px,100vw); background:var(--cream); z-index:200; transform:translateX(100%); transition:transform 0.5s cubic-bezier(0.22,1,0.36,1); display:flex; flex-direction:column; box-shadow:-20px 0 60px rgba(0,0,0,0.3); }
  #info-panel.open { transform:translateX(0); }
  .panel-header { background:var(--ocean-deep); padding:24px; display:flex; align-items:center; justify-content:space-between; }
  .panel-title { font-family:'Cormorant Garamond',serif; font-size:22px; font-weight:300; color:white; }
  .panel-close { width:36px; height:36px; border-radius:50%; background:rgba(255,255,255,0.1); border:none; color:white; font-size:18px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.2s; }
  .panel-close:hover { background:rgba(255,255,255,0.2); }
  .panel-body { padding:28px; overflow-y:auto; flex:1; }
  .icard { background:white; border-radius:14px; padding:20px; margin-bottom:16px; border-left:3px solid var(--gold); box-shadow:0 2px 12px rgba(0,0,0,0.06); }
  .icard-hd { display:flex; align-items:center; gap:12px; margin-bottom:10px; }
  .icard-icon { width:40px; height:40px; border-radius:10px; background:var(--warm); display:flex; align-items:center; justify-content:center; font-size:20px; flex-shrink:0; }
  .icard h4 { font-size:15px; font-weight:500; color:var(--ocean-deep); }
  .icard p { font-size:14px; color:#555; line-height:1.65; }
  .copy-btn { display:inline-flex; align-items:center; gap:6px; margin-top:10px; background:var(--ocean); color:white; border:none; border-radius:7px; padding:7px 14px; font-size:12px; font-family:'Jost',sans-serif; cursor:pointer; transition:all 0.2s; }
  .copy-btn:hover { background:var(--ocean-deep); }
  @keyframes fadeUp { from{opacity:0;transform:translateY(24px)} to{opacity:1;transform:translateY(0)} }
  @keyframes fadeIn { from{opacity:0} to{opacity:1} }
  .sos-pill { background:rgba(220,50,50,0.12) !important; border-color:rgba(220,80,80,0.35) !important; color:#FF8A8A !important; }
  .sos-pill:hover { background:rgba(220,50,50,0.25) !important; border-color:rgba(220,80,80,0.6) !important; }
  .sos-pill.active { background:rgba(220,50,50,0.3) !important; border-color:rgba(220,80,80,0.7) !important; color:#FFB3B3 !important; }
  .problem-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:12px; margin-bottom:28px; }
  .problem-btn { background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.12); border-radius:14px; padding:20px 18px; cursor:pointer; transition:all 0.25s; text-align:left; color:white; font-family:"Jost",sans-serif; width:100%; text-decoration:none; display:block; }
  .problem-btn:hover { background:rgba(255,100,100,0.15); border-color:rgba(255,100,100,0.4); transform:translateY(-2px); }
  .problem-btn .pb-icon { font-size:28px; margin-bottom:10px; }
  .problem-btn .pb-title { font-size:14px; font-weight:500; margin-bottom:4px; }
  .problem-btn .pb-sub { font-size:12px; color:rgba(255,255,255,0.45); line-height:1.4; }
  .wa-direct { display:flex; align-items:center; gap:12px; background:rgba(37,211,102,0.12); border:1px solid rgba(37,211,102,0.35); border-radius:14px; padding:18px 22px; color:white; text-decoration:none; transition:all 0.25s; margin-bottom:10px; }
  .wa-direct:hover { background:rgba(37,211,102,0.22); border-color:rgba(37,211,102,0.6); }
  .wa-direct .wa-icon { font-size:26px; flex-shrink:0; }
  .wa-direct h4 { font-size:14px; font-weight:500; margin-bottom:2px; }
  .wa-direct p { font-size:12px; color:rgba(255,255,255,0.5); }
  @media(max-width:600px) { h1{font-size:52px} .hero-strip{display:none} .tour-bar{padding:10px 14px} .chapter-bar{padding:10px 14px} .chapter-card{padding:28px 20px} }
</style>
</head>
<body>

<div id="welcome">
  <div class="hero-bg" id="heroBg"></div>
  <div class="hero-overlay"></div>
  <div class="hero-strip">
    <div class="strip-badge" id="locationBadge"></div>
  </div>
  <div class="hero-content">
    <div class="property-tag">Your home away from home</div>
    <h1 id="heroTitle"></h1>
    <div class="location-line"><span>Welcome to your home by the sea</span></div>
    <div class="cta-group">
      <button class="btn-primary" onclick="startGuided()">
        <div><div>Take me through the home</div><div class="btn-sub">Guided tour ¬∑ perfect for everyone</div></div>
        <div class="arr">‚ñ∂</div>
      </button>
    </div>
  </div>
</div>

<div id="tour-screen">
  <div class="tour-bar">
    <div style="display:flex;align-items:center;gap:14px;">
      <button class="back-btn" onclick="goBack()">‚Üê Home</button>
      <div class="tour-brand" id="tourBrand"></div>
    </div>
    <div class="tour-actions">
      <button class="tour-btn gold" onclick="openPanel()">üìã House Info</button>
      <a id="waBtn" href="#" target="_blank" class="tour-btn">üí¨ WhatsApp</a>
    </div>
  </div>
  <div class="chapter-bar" id="chapterBar"></div>
  <div class="tour-main">
    <div id="chapterOverlay">
      <div class="chapter-card" id="chapterContent"></div>
    </div>
  </div>
</div>

<div id="info-panel">
  <div class="panel-header">
    <div class="panel-title">Your Stay Info</div>
    <button class="panel-close" onclick="closePanel()">‚úï</button>
  </div>
  <div class="panel-body" id="panelBody"></div>
</div>
<div id="overlay" onclick="closePanel()" style="position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:190;opacity:0;pointer-events:none;transition:opacity 0.4s;"></div>

<script>
// ‚îÄ‚îÄ DYNAMIC DATA LOADER ‚îÄ‚îÄ
const REPO_RAW = "https://raw.githubusercontent.com/danielngr/2302-page/main/data";

async function loadData() {
  const params = new URLSearchParams(window.location.search);
  const deptId = params.get("dept") || "2302";
  try {
    const res = await fetch(`${REPO_RAW}/${deptId}.json`);
    if (!res.ok) throw new Error("not found");
    return await res.json();
  } catch(e) {
    console.error("Error loading data:", e);
    return null;
  }
}



// ‚îÄ‚îÄ SUPABASE ANALYTICS ‚îÄ‚îÄ
const SB_URL = "https://grsykedeppdwenpfxlfh.supabase.co";
const SB_KEY = "sb_publishable_H5I7SXxD2jqFbrgr4En6Cg_9lPzisnm";

async function trackVisit() {
  if (!window.D) return;
  try {
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'unknown';
    await fetch(SB_URL + '/rest/v1/visits', {
      method: 'POST',
      headers: {
        'apikey': SB_KEY,
        'Authorization': 'Bearer ' + SB_KEY,
        'Content-Type': 'application/json',
        'Prefer': 'return=minimal'
      },
      body: JSON.stringify({ dept: window.D.id, lang: 'en', timezone: tz })
    });
  } catch(e) {}
}

async function trackPillClick(pillLabel) {
  if (!window.D) return;
  try {
    await fetch(SB_URL + '/rest/v1/pill_clicks', {
      method: 'POST',
      headers: {
        'apikey': SB_KEY,
        'Authorization': 'Bearer ' + SB_KEY,
        'Content-Type': 'application/json',
        'Prefer': 'return=minimal'
      },
      body: JSON.stringify({ dept: window.D.id, lang: 'en', pill_label: pillLabel })
    });
  } catch(e) {}
}

document.addEventListener("DOMContentLoaded", async () => {
  window.D = await loadData();
  if (!window.D) {
    document.body.innerHTML = "<div style=\"color:white;padding:40px;font-family:sans-serif\">‚ùå Department not found. Please check the URL.</div>";
    return;
  }
  initPage();
  trackVisit();
});

function initPage() {
  const D = window.D;
  // Welcome screen
  document.getElementById('heroBg').style.backgroundImage = `url('${D.coverImage}')`;
  document.getElementById('locationBadge').textContent = D.location;
  document.getElementById('heroTitle').innerHTML = `${D.name}<br><em>${D.subtitle_en}</em>`;
  document.title = `${D.name} ¬∑ ${D.location}`;

  // Tour screen
  document.getElementById('tourBrand').innerHTML = `${D.name} <em>PV</em>`;
  document.getElementById('waBtn').href = `https://wa.me/${D.phone}`;

  // Pills
  buildPills();

  // Panel
  buildPanel();
}

function buildPills() {
  const D = window.D;
  const pills = [
    { icon:'üö™', label:'Arrival' },
    { icon:'üõã', label:'Living & Dining' },
    { icon:'üç≥', label:'Kitchen' },
    { icon:'üõè', label: (D.bedrooms && D.bedrooms.length === 1) ? 'Bedroom' : 'Bedrooms' },
    { icon:'üöø', label: (D.bathrooms === 1) ? 'Bathroom' : 'Bathrooms' },
    { icon:'üèä', label: D.hasTerrace !== false ? 'Terrace & Pool' : 'Complex Pools' },
    { icon:'üåÆ', label:'Local Spots' },
    { icon:'‚ÑπÔ∏è', label:'House Info' },
    ...(D.hasQuiya ? [{ icon:'üçΩ', label:'Quiya Restaurant' }] : []),
    { icon:'üå§', label:"Today's Weather" },
    { icon:'üÜò', label:'I have a problem', sos: true },
  ];
  const bar = document.getElementById('chapterBar');
  bar.innerHTML = pills.map((p,i) =>
    `<div class="chapter-pill${i===0?' active':''}${p.sos?' sos-pill':''}" onclick="openChapter(${i});trackPillClick('${p.label}')"><div class="chapter-dot"></div>${p.icon} ${p.label}</div>`
  ).join('');
}

function buildPanel() {
  const D = window.D;
  const p = D.panelInfo_en;
  document.getElementById('panelBody').innerHTML = `
    <div class="icard">
      <div class="icard-hd"><div class="icard-icon">üì∂</div><h4>WiFi</h4></div>
      <p>${p.wifi}</p>
      <button class="copy-btn" onclick="copyText('${D.wifi.password}',this)">üìã Copy password</button>
    </div>
    <div class="icard">
      <div class="icard-hd"><div class="icard-icon">üîë</div><h4>Entrada & Check-in</h4></div>
      <p>${p.entry}</p>
    </div>
    <div class="icard">
      <div class="icard-hd"><div class="icard-icon">‚ùÑÔ∏è</div><h4>Aire acondicionado</h4></div>
      <p>${p.ac}</p>
    </div>
    <div class="icard">
      <div class="icard-hd"><div class="icard-icon">üßπ</div><h4>Limpieza adicional</h4></div>
      <p>${p.cleaning}</p>
      <a href="https://wa.me/${D.phone}" target="_blank" class="copy-btn" style="text-decoration:none">üí¨ Solicitar</a>
    </div>
  `;
}

// ‚îÄ‚îÄ CHAPTERS ‚îÄ‚îÄ
let currentChapterIdx = 0;

function getChapters() {
  const D = window.D;
  const WA = D.phone;
  const deptName = D.name;
  return [
    {
      label:'How to Arrive', title:`Welcome to\n${D.name}`,
      desc:'Your experience starts here. Follow the arrival instructions and you\'ll be inside in minutes.',
      map: D.coordinates,
      info:[
        { icon:'üìã', title:'Gate Registration', body:'At Quiya, head to the <strong>entrance gate</strong> where staff will register you for access.<br><br>‚ö†Ô∏è <em>Make sure you have previously sent the names of all guests to the host ‚Äî without it access may be delayed.</em>' },
        { icon:'üîë', title:'Apartment Access', body: D.keyAccess_en },
        { icon:'üöó', title:'Parking', body: D.parking_en },
      ]
    },
    {
      label:'Social Spaces', title:'Living &\nDining Room',
      desc:'The heart of the apartment. Perfect space to gather, with living area, dining room and terrace access.',
      image: D.images.living,
      info:[
        { icon:'üì∫', title:'Television', body:'Smart TV with streaming apps available (Netflix, Prime Video, etc.). Sign in with your own accounts. Remotes are on the table.' },
        { icon:'‚ùÑÔ∏è', title:'Air Conditioning', body:'Wall control on the side. Recommended temperature: 22¬∞C.' },
      ]
    },
    {
      label:'Kitchen', title:'Your full\nkitchen',
      desc:'Fully equipped with everything you need. Coffee maker, toaster, blender and basic utensils included.',
      image: D.images.kitchen,
      info:[
        { icon:'üç≥', title:'Cookware', body:'Pans, pots and utensils in good condition.' },
        { icon:'üçΩ', title:'Dishes', body:'Plates, glasses, cups, wine glasses, bowls, cutlery and water jug.' },
        { icon:'üî™', title:'Knives & more', body:'Knife set, tupperware and corkscrew.' },
        { icon:'‚òï', title:'Appliances', body:'Coffee maker, toaster, blender, microwave and oven with mitts.' },
        { icon:'üíß', title:'Water', body:'The entire Quiya complex has a drinking water filtration system ‚Äî tap water is completely safe to drink.' },
        { icon:'üßÇ', title:'Pantry basics', body:'Coffee, sugar, tea, salt, pepper and oil.' },
        { icon:'üóë', title:'Trash', body:'Staff picks up at <strong>10:00 am</strong> and <strong>2:00 pm</strong>.' },
      ]
    },
    {
      label:'Rest', title:'The\nBedrooms',
      desc:`${D.bedrooms.length} bedrooms with everything you need to rest comfortably.`,
      images: [D.images.bedroom1, D.images.bedroom2].filter(Boolean),
      info:[
        ...D.bedrooms.map(b => ({ icon: b.icon, title: b.title_en, body: b.body_en })),
        { icon:'üëî', title:'Closet', body: D.safe_en },
        { icon:'‚ùÑÔ∏è', title:'Air Conditioning', body:'Remember to turn it off when leaving the apartment.' },
      ]
    },
    {
      label:'Bathrooms', title:'The\nBathrooms',
      desc:'Clean towels in each bathroom. If you need more, extras are in the hallway closet.',
      images: [D.images.bathroom1, D.images.bathroom2].filter(Boolean),
      info:[
        { icon:'üöø', title:`${D.bathrooms} full bathrooms`, body:'Regadera, sanitario y lavabo en cada uno.' },
        { icon:'üß¥', title:'Amenities', body:'Shampoo, conditioner, body wash and hand soap included.' },
        { icon:'ü™•', title:'Towels', body:'Bath towels and pool towels available.' },
        { icon:'üíá', title:'Extras', body:'Hair dryer, iron and ironing board.' },
        { icon:'üëï', title:'Washing Machine', body:'Normal cycle: 45 min. Detergent is under the kitchen sink along with other soaps in small bottles.' },
        { icon:'‚ÑπÔ∏è', title:'Amenities note', body:'The amenities we provide (shampoo, soaps, detergent, coffee, etc.) are a welcome courtesy ‚Äî only one initial set is provided. If they run out during your stay, you can get more at any nearby store.' },
      ]
    },
    D.hasTerrace !== false ? {
      label:'Your paradise', title:'Terrace\n& Pool',
      desc:'Your outdoor space with a private pool and access to the complex common areas.',
      image: D.images.terrace,
      info:[
        { icon:'üèä', title:'Private pool', body:'The terrace has a private pool for exclusive use. No schedule ‚Äî available 24 hours.' },
        { icon:'üåä', title:'Complex pools', body:'You also have access to the Selva, Bar and beachfront pools. Towels available at the pool area.' },
        { icon:'‚ö†Ô∏è', title:'Complex common areas', body:'At the complex pools (Selva, Bar, beach) <strong>only products purchased at the Quiya restaurant are allowed</strong>. Own drinks only in a closed thermos or Yeti.' },
      ]
    } : {
      label:'Pools', title:'Complex\nPools',
      desc: D.poolInfo_en || 'Enjoy the 3 shared pools at the Quiya complex.',
      image: 'https://i.imgur.com/IAHXB3q.jpeg',
      info:[
        { icon:'üåø', title:'Jungle Pool', body:'Surrounded by tropical vegetation. The most relaxed atmosphere in the complex.' },
        { icon:'üçπ', title:'Bar Pool', body:'With drink and snack service from the bar. Perfect for midday.' },
        { icon:'üåä', title:'Beachfront Pool', body:'With direct ocean views. Most popular at sunset.' },
        { icon:'üèñ', title:'Beach towels', body:'Available at the pool area.' },
        { icon:'‚ö†Ô∏è', title:'Complex rule', body:'At the shared pools <strong>only Quiya restaurant products are allowed</strong>. Own drinks only in a closed thermos or Yeti.' },
      ]
    },
    {
      label:'Recommendations', title:'Your secret\nspots',
      desc:`Places you won't find on TripAdvisor. I only share these with ${D.name} guests.`,
      spots: D.localSpots.map((s,i) => ({ num: String(i+1), name: s.name, desc: s.desc_en }))
    },
    {
      label:'Practical Info', title:'Everything you\nneed to know',
      desc:'Key information for your stay. For any questions, message us on WhatsApp.',
      info:[
        { icon:'üì∂', title:`WiFi ¬∑ ${D.wifi.network}`, body:`Password: <strong>${D.wifi.password}</strong>`, copy: D.wifi.password },
        { icon:'üìã', title:'Gate Registration', body:'At Quiya, head to the <strong>entrance gate</strong> where staff will register you for access.<br><br>‚ö†Ô∏è <em>Make sure you have previously sent the names of all guests to the host ‚Äî without it access may be delayed.</em>' },
        { icon:'üîë', title:'Apartment Access', body: D.keyAccess_en },
        { icon:'üïê', title:'Check-out', body:`At ${D.checkout}. If you need a late checkout let us know 24h in advance.` },
        { icon:'üöë', title:'Emergencies', body:`<strong>911</strong> ‚Äî Police, ambulance and fire.<br>Host 24/7: <a href="tel:+${D.phone}" style="color:var(--gold-light)">+${D.phone}</a>` },
        { icon:'üßπ', title:'Additional cleaning', body:'Available with 24h notice via WhatsApp. Free for stays of 7+ nights.' },
      ]
    },
    ...(D.hasQuiya ? [{ label:'Inside the complex', title:'Quiya\nRestaurant', desc:'Eat and drink without leaving the complex. Full menu and hours below.', quiya:true }] : []),
    {
      label: D.location, title:"Today's\nWeather",
      desc:'Real-time temperature, wind and rain so you can plan your day perfectly.',
      weather: true
    },
    {
      label:'We\'re here to help', title:'I have a\nproblem',
      desc:'Select what\'s happening and we\'ll send a direct WhatsApp message ‚Äî we respond in minutes.',
      sos: true
    }
  ];
}

function setActivePill(idx) {
  document.querySelectorAll('.chapter-pill').forEach((p,i) => p.classList.toggle('active', i===idx));
  const pill = document.querySelectorAll('.chapter-pill')[idx];
  if (pill) pill.scrollIntoView({ behavior:'smooth', inline:'center', block:'nearest' });
}

function menuSection(title, hours, sections) {
  let h = `<div style="margin-bottom:24px;">
    <div style="display:flex;align-items:baseline;justify-content:space-between;flex-wrap:wrap;gap:8px;margin-bottom:12px;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,0.1);">
      <div style="font-family:'Cormorant Garamond',serif;font-size:22px;color:white;font-weight:400;">${title}</div>
      <div style="font-size:11px;letter-spacing:2px;text-transform:uppercase;color:var(--gold);">${hours}</div>
    </div>`;
  sections.forEach(s => {
    h += `<div style="margin-bottom:14px;">
      <div style="font-size:10px;letter-spacing:3px;text-transform:uppercase;color:rgba(255,255,255,0.4);margin-bottom:8px;">${s.cat}</div>
      <div style="display:flex;flex-direction:column;gap:4px;">`;
    s.items.forEach(([name, price]) => {
      h += `<div style="display:flex;justify-content:space-between;align-items:baseline;gap:12px;font-size:13px;">
        <span style="color:rgba(255,255,255,0.75);line-height:1.5;">${name}</span>
        <span style="color:var(--gold-light);font-weight:500;white-space:nowrap;flex-shrink:0;">${price}</span>
      </div>`;
    });
    h += `</div></div>`;
  });
  h += `</div>`;
  return h;
}

function openChapter(idx) {
  const D = window.D;
  currentChapterIdx = idx;
  setActivePill(idx);
  const chapters = getChapters();
  const ch = chapters[idx];
  const overlay = document.getElementById('chapterOverlay');
  const content = document.getElementById('chapterContent');

  let html = `
    <div class="chapter-card-label">${ch.label}</div>
    <h2>${ch.title.replace('\n','<br>')}</h2>
    <p class="chapter-desc">${ch.desc}</p>
  `;

  if (ch.image) {
    html += `<div style="width:100%;height:220px;border-radius:16px;overflow:hidden;margin-bottom:24px;border:1px solid rgba(255,255,255,0.08);box-shadow:0 8px 32px rgba(0,0,0,0.3);">
      <img src="${ch.image}" style="width:100%;height:100%;object-fit:cover;display:block;transition:transform 0.4s;" onmouseover="this.style.transform='scale(1.04)'" onmouseout="this.style.transform='scale(1)'"/>
    </div>`;
  }
  if (ch.images && ch.images.length) {
    html += `<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:24px;">`;
    ch.images.forEach(src => {
      html += `<div style="height:200px;border-radius:14px;overflow:hidden;border:1px solid rgba(255,255,255,0.08);box-shadow:0 6px 24px rgba(0,0,0,0.3);">
        <img src="${src}" style="width:100%;height:100%;object-fit:cover;display:block;transition:transform 0.4s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'"/>
      </div>`;
    });
    html += `</div>`;
  }

  if (ch.map) {
    html += `<div style="border-radius:16px;overflow:hidden;margin-bottom:24px;border:1px solid rgba(255,255,255,0.1);">
      <div style="background:rgba(255,255,255,0.06);padding:12px 18px;display:flex;align-items:center;justify-content:space-between;">
        <div style="font-size:13px;color:rgba(255,255,255,0.7);display:flex;align-items:center;gap:8px;"><span>üìç</span> Exact property location</div>
        <a href="https://maps.google.com/?q=${ch.map.lat},${ch.map.lng}" target="_blank" style="font-size:12px;color:var(--gold-light);text-decoration:none;">Open in Maps ‚Üó</a>
      </div>
      <iframe src="https://maps.google.com/maps?q=${ch.map.lat},${ch.map.lng}&z=17&output=embed" width="100%" height="280" style="border:none;display:block;" loading="lazy"></iframe>
    </div>`;
  }

  if (ch.info) {
    ch.info.forEach(r => {
      html += `<div class="info-row">
        <div class="info-row-icon">${r.icon}</div>
        <div><h4>${r.title}</h4><p>${r.body}</p>
        ${r.copy ? `<button class="copy-inline" onclick="copyText('${r.copy}',this)">üìã Copiar</button>` : ''}
        </div>
      </div>`;
    });
  }

  if (ch.spots) {
    ch.spots.forEach(s => {
      html += `<div class="spot-row">
        <div class="spot-num-w">${s.num}</div>
        <div><h5>${s.name}</h5><p>${s.desc}</p></div>
      </div>`;
    });
  }

  if (ch.quiya) {
    html += `
    <div style="margin-bottom:20px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:14px;padding:16px 20px;">
      <div style="font-size:11px;letter-spacing:3px;text-transform:uppercase;color:var(--gold);margin-bottom:4px;">Every day</div>
      <div style="font-size:13px;color:rgba(255,255,255,0.6);line-height:1.8;">
        ‚òÄÔ∏è <strong style="color:white;">Pasatiempo ¬∑ Deli Caf√©</strong> ‚Äî 7:00 am a 3:00 pm<br>
        üç≥ <strong style="color:white;">La Palma ¬∑ Desayuno</strong> ‚Äî 8:00 am a 12:00 pm<br>
        üåÆ <strong style="color:white;">La Palma ¬∑ Comida</strong> ‚Äî 12:00 pm a 5:00 pm<br>
        üç∑ <strong style="color:white;">La Palma ¬∑ Cena</strong> ‚Äî 5:00 pm a 9:00 pm<br>
        üèñ <strong style="color:white;">Snack Bar</strong> ‚Äî Pool area
      </div>
    </div>
    ${menuSection('‚òÄÔ∏è Pasatiempo ¬∑ Deli Caf√©','7:00 am ‚Äì 3:00 pm',[{cat:'Ensaladas',items:[['Cobb','$195'],['C√©sar','$160'],['C√©sar con Pollo','$180'],['Griega','$210']]},{cat:'Paninis',items:[['Philly Steak Panini ‚Äî arrachera, pimientos, mayonesa con c√∫rcuma','$235'],['Panini Vegetariano ‚Äî queso de cabra, hongo, espinaca, romero','$210']]},{cat:'Emparedados',items:[['Florentino ‚Äî jam√≥n, espinaca, tocino, huevo, queso blanco','$180'],['Patty Melt ‚Äî carne molida, queso, cebolla caramelizada','$180'],['Montecristo ‚Äî pavo, huevo, az√∫car glass','$150'],['Bagel de Salm√≥n ‚Äî salm√≥n, alcaparras, queso crema','$210'],['Croissant de Huevo','$150']]},{cat:'Caf√©',items:[['Americano','$55'],['Cappuccino','$75'],['Latte','$75'],['Espresso','$75'],['Bebidas Frappe','$105']]},{cat:'Jugos',items:[['Vampiro ‚Äî betabel, pi√±a, jengibre, naranja, lim√≥n, miel','$75'],['Menta ‚Äî menta, pepino, pi√±a, apio, manzana, miel','$75'],['Verde Gardens ‚Äî kale, jengibre, espinaca, manzana, pepino, perejil, toronja','$75'],['Apio-Zanahoria','$75']]},{cat:'Smoothies',items:[['Blueberries','$105'],['Mango','$85'],['Kiwi','$105'],['Tropical','$85']]}])}
    ${menuSection('üç≥ La Palma ¬∑ Desayuno','8:00 am ‚Äì 12:00 pm',[{cat:'Cl√°sicos',items:[['Desayuno Buffet','$390'],['Avena con leche/soya/almendra','$198'],['Plato Fruta de Temporada con granola','$205'],['Pan Franc√©s con az√∫car y canela','$270'],['Hot Cake Naturales / Pl√°tano / Manzana','$275'],['Huevos al Gusto 2pzas ‚Äî revueltos, fritos o divorciados','$300']]},{cat:'Especialidades',items:[['Huevos Motule√±os ‚Äî pl√°tano macho, chicharos, jam√≥n','$312'],['Huevos con Arrachera ‚Äî frijoles, aguacate, queso panela','$360'],['Huevos Divorciados en Salsa Verde y Roja','$312'],['Huevos Benedictos Gratinados ‚Äî salsa holandesa, papa hash brown','$324'],['Huevos Efigenia ‚Äî ahogados en salsa verde o roja, aguacate','$200'],['Omelette al Gusto','$324'],['Omelette Gardens ‚Äî pimiento, espinaca, champi√±√≥n, cebolla morada, reques√≥n','$252'],['Machaca con Huevo y Rajas Poblanas','$312']]},{cat:'Chilaquiles & Burritos',items:[['Chilaquiles ‚Äî roja, verde, morita o mole','$275'],['Chilaquiles con Pollo 180gr','$300'],['Burrito Vegetariano ‚Äî mezcla de vegetales, queso, germinado','$312'],['Burrito Gardens ‚Äî jam√≥n, queso, huevo, tocino','$324']]},{cat:'Extras',items:[['Camar√≥n 100gr','$111'],['Arrachera 50gr','$111'],['Pollo 100gr','$111'],['Aguacate 50gr','$60'],['Tocino o Salchichas 100gr','$111']]}])}
    ${menuSection('üåÆ La Palma ¬∑ Comida','12:00 pm ‚Äì 5:00 pm',[{cat:'Entradas',items:[['Ceviche Tatemado de Pesca del D√≠a','$300'],['Camarones a la Gabardina ‚Äî empanizado, tempura de cerveza','$540'],['Taco de Marl√≠n ‚Äî jitomate, queso gratinado, tortilla','$220'],['Sopa de Tortilla 370ml','$216'],['Quesadilla con Arrachera y Tortilla de Ma√≠z','$360'],['Tostada de Camar√≥n fresco cocido','$220'],['Taco Placero ‚Äî pesca del d√≠a al ajillo, papa rostizada','$240'],['Nachos ‚Äî frijoles, prote√≠na, queso, jalape√±os, guacamole','$276']]},{cat:'Plato Fuerte',items:[['Camarones al Gusto 200gr','$492'],['Camarones Zarandeados 200gr','$492'],['Pesca del D√≠a a la Diabla 220gr','$745'],['Pesca del D√≠a al Gusto 220gr','$745'],['Rib Eye en Fajas 500gr','$984'],['Alambre de Res 250gr','$546'],['Arrachera 250gr ‚Äî frijoles, guacamole, chiles toreados','$648'],['Enchiladas de Mariscos ‚Äî camar√≥n, pulpo, pesca, callo','$598'],['Taquitos de Pollo Estilo Vallarta 180gr','$264'],['Club Sandwich 70gr','$264'],['La Cruz Burger 250gr','$456']]},{cat:'Postres',items:[['Brownie de Chocolate','$210'],['Panacota de Menta','$210'],['Cr√®me Br√ªl√©e','$210'],['Pay de Manzana','$210'],['Helados ‚Äî Vainilla, Chocolate, Fresa, Pistache','$210']]}])}
    ${menuSection('üç∑ La Palma ¬∑ Cena','5:00 pm ‚Äì 9:00 pm',[{cat:'Entradas',items:[['Carpacio de Salm√≥n 200gr ‚Äî alcaparras, ar√∫gula, mostaza Dijon','$378'],['Ensalada Gardens 100gr ‚Äî lechugas, hierbabuena, albahaca, frutos rojos','$192'],['Ensalada de Pera 100gr ‚Äî jitomate, queso azul, nuez, miel','$192'],['Aguacate Relleno de Camar√≥n 180gr','$378'],['T√°rtar de At√∫n 180gr ‚Äî aguacate, aceite de oliva, mostaza','$420']]},{cat:'Plato Fuerte',items:[['Pesca en La Cruz 220gr ‚Äî hierbas mexicanas, lim√≥n, hoja de tamal','$745'],['Pesca del D√≠a Zarandeado 220gr ‚Äî adobo de chiles y lim√≥n','$745'],['Medallones de Res al Vino Tinto 220gr ‚Äî pure de papa r√∫stico, esp√°rrago','$546'],['Rib Eye 500gr ‚Äî Angus, papa horno, vegetales, cebolla flameada','$984'],['Pollo Relleno 4 Quesos 200gr ‚Äî pechuga, espinaca, champi√±√≥n, mozzarella','$420'],['La Cruz Burger 250gr','$456'],['Arroz con Mariscos ‚Äî camar√≥n, pulpo, pesca, callo','$420'],['Camarones al Vino Blanco 200gr','$492'],['Camarones al Gusto 200gr','$492'],['Surf & Turf con Camar√≥n ‚Äî camar√≥n jumbo + filete de res','$1,080'],['Surf & Turf con Langosta ‚Äî langosta 320gr + filete de res','$1,680']]},{cat:'Postres',items:[['Brownie de Chocolate','$210'],['Panacota de Menta','$210'],['Cr√®me Br√ªl√©e','$210'],['Pay de Manzana','$210'],['Helados','$210']]}])}
    ${menuSection('üèñ Snack Bar','Pool area',[{cat:'Botanas',items:[['Guacamole con At√∫n Fresco 120gr','$420'],['Guacamole con Chicharr√≥n de Pescado 200gr','$420'],['Guacamole con Chicharr√≥n de Pulpo 200gr','$420'],['Papas a la Francesa 250gr','$111'],['Garden Sliders con Queso ‚Äî 3 pzas','$294']]},{cat:'Ceviche & Tacos',items:[['Ceviche de Camar√≥n Chilpet√≠n 140gr','$312'],['Ceviche de Pescado Vallarta 140gr','$312'],['Taco Baja de Pescado ‚Äî 2 pzas','$252'],['Tacos de Camar√≥n Capeado ‚Äî 2 pzas','$300']]},{cat:'Quesadillas & Sandwiches',items:[['Quesadillas de Pollo ‚Äî 2 pzas tortilla de harina','$264'],['Quesadillas de Arrachera ‚Äî 2 pzas','$360'],['Sandwich de Pollo en Brioche','$180'],['Club Sandwich ‚Äî pollo, jam√≥n, queso','$264']]},{cat:'Alitas & Men√∫ Infantil',items:[['Alitas de Pollo 250gr ‚Äî BBQ, B√∫falo o Teriyaki, 8 pzas','$168'],['Deditos de Pescado con salsa de jitomat√©','$156'],['Quesadillas Naturales ‚Äî 2 pzas','$192'],['Tenders de Pollo Empanizado','$136'],['Sandwich de Queso Gratinado','$156']]},{cat:'Postres',items:[['Brownie Relleno con Nieve','$210']]}])}
    `;
  }

  if (ch.weather) {
    const W = D.weather;
    html += `
    <div style="border-radius:16px;overflow:hidden;margin-bottom:20px;border:1px solid rgba(255,255,255,0.1);">
      <iframe src="https://embed.windy.com/embed2.html?lat=${W.lat}&lon=${W.lng}&detailLat=${W.lat}&detailLon=${W.lng}&width=650&height=450&zoom=11&level=surface&overlay=temp&product=ecmwf&menu=&message=true&marker=true&calendar=now&pressure=&type=map&location=coordinates&detail=true&metricWind=km%2Fh&metricTemp=%C2%B0C&radarRange=-1"
        width="100%" height="420" style="border:none;display:block;" frameborder="0"></iframe>
    </div>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;margin-bottom:8px;">
      <div style="background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:16px;text-align:center;">
        <div style="font-size:28px;margin-bottom:6px;">üå°</div>
        <div style="font-size:12px;color:rgba(255,255,255,0.5);margin-bottom:2px;">Typical temperature</div>
        <div style="font-size:18px;font-weight:500;color:white;">${W.tempRange}</div>
      </div>
      <div style="background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:16px;text-align:center;">
        <div style="font-size:28px;margin-bottom:6px;">üåä</div>
        <div style="font-size:12px;color:rgba(255,255,255,0.5);margin-bottom:2px;">Sea temperature</div>
        <div style="font-size:18px;font-weight:500;color:white;">${W.seaTemp}</div>
      </div>
      <div style="background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:16px;text-align:center;">
        <div style="font-size:28px;margin-bottom:6px;">üåÖ</div>
        <div style="font-size:12px;color:rgba(255,255,255,0.5);margin-bottom:2px;">Best sunset</div>
        <div style="font-size:18px;font-weight:500;color:white;">${W.sunset}</div>
      </div>
    </div>`;
  }

  if (ch.sos) {
    const problems = [
      { icon:'üíß', title:'No hot water', sub:'Boiler or shower issue', msg:`Hola, I'm staying at ${D.name} and there's no hot water. Can you help?` },
      { icon:'‚ùÑÔ∏è', title:'A/C not working', sub:'Not cooling or not turning on', msg:`Hola, I'm staying at ${D.name} and the air conditioning is not working. Can you help?` },
      { icon:'üì∂', title:'No WiFi', sub:'No connection or very slow signal', msg:`Hola, I'm staying at ${D.name} and there's no WiFi connection. Can you help?` },
      { icon:'üîë', title:"Can't get in", sub:'Issue with key or code', msg:`Hola, I'm staying at ${D.name} and I have a problem getting into the property. Can you help?` },
      { icon:'üöø', title:'Bathroom issue', sub:'Leak, clog or toilet', msg:`Hola, I'm staying at ${D.name} and there's a bathroom issue. Can you help?` },
      { icon:'üí°', title:'No electricity', sub:'Power outage or blown bulb', msg:`Hola, I'm staying at ${D.name} and there's an electrical issue, no power in the property. Can you help?` },
      { icon:'ü™≥', title:'Cleaning issue', sub:'Something that needs attention', msg:`Hola, I'm staying at ${D.name} and there's a cleaning issue that needs attention. Can you help?` },
      { icon:'üí¨', title:'Other issue', sub:'Message us directly', msg:`Hola, I'm staying at ${D.name} and I need help with the following: ` },
    ];
    html += `<div class="problem-grid">`;
    problems.forEach(p => {
      html += `<a href="https://wa.me/${WA}?text=${encodeURIComponent(p.msg)}" target="_blank" class="problem-btn">
        <div class="pb-icon">${p.icon}</div>
        <div class="pb-title">${p.title}</div>
        <div class="pb-sub">${p.sub}</div>
      </a>`;
    });
    html += `</div>
    <a href="https://wa.me/${WA}" target="_blank" class="wa-direct">
      <div class="wa-icon">üí¨</div>
      <div><h4>Talk directly with us</h4><p>WhatsApp ¬∑ We respond in minutes</p></div>
    </a>`;
  }

  content.innerHTML = html;
  overlay.classList.add('open');
  overlay.scrollTop = 0;
}


function showTour() {
  document.getElementById('welcome').classList.add('hiding');
  setTimeout(() => {
    document.getElementById('welcome').style.display = 'none';
    document.getElementById('tour-screen').classList.add('active');
  }, 800);
}

function startGuided() { showTour(); setTimeout(() => openChapter(0), 400); }

function goBack() {
  document.getElementById('tour-screen').classList.remove('active');
  const w = document.getElementById('welcome');
  w.style.display = '';
  setTimeout(() => w.classList.remove('hiding'), 50);
  document.getElementById('chapterOverlay').classList.remove('open');
  setActivePill(0);
}

function openPanel() {
  document.getElementById('info-panel').classList.add('open');
  const ov = document.getElementById('overlay');
  ov.style.opacity='1'; ov.style.pointerEvents='all';
}
function closePanel() {
  document.getElementById('info-panel').classList.remove('open');
  const ov = document.getElementById('overlay');
  ov.style.opacity='0'; ov.style.pointerEvents='none';
}

function copyText(text, btn) {
  navigator.clipboard.writeText(text).then(() => {
    const orig = btn.textContent;
    btn.textContent = '‚úì Copied';
    setTimeout(() => btn.textContent = orig, 2000);
  });
}
</script>
</body>
</html>
